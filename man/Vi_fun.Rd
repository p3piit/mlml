% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/Vi_fun.R
\name{Vi_fun}
\alias{Vi_fun}
\title{Build cluster-specific covariance matrices V_i}
\usage{
Vi_fun(Z, D, s2, G, idx, w)
}
\arguments{
\item{Z}{Numeric matrix (N x q). Random-effects design matrix (stacked by cluster).}

\item{D}{Numeric matrix (q x q). Random-effects covariance matrix.}

\item{s2}{Numeric scalar. Residual variance on the working scale.}

\item{G}{Integer. Number of clusters.}

\item{idx}{List of length \code{G}. Row indices for each cluster.}

\item{w}{Numeric vector length N. Working weights.}
}
\value{
A list of length \code{G}. Each element is an \eqn{n_i \times n_i}
covariance matrix \eqn{V_i}.
}
\description{
Internal helper for GMERT/GMERF. For each cluster \eqn{i}, constructs
\eqn{V_i = (W_i^{1/2} Z_i) D (W_i^{1/2} Z_i)^T + \sigma^2 I_{n_i}},
where \eqn{W_i} is the diagonal working-weight matrix.
}
\keyword{internal}
