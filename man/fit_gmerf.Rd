% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/fit_gmerf.R
\name{fit_gmerf}
\alias{fit_gmerf}
\title{Fit a Generalized Mixed-Effects Random Forest model (GMERF)}
\usage{
fit_gmerf(
  df,
  id = "id",
  target = "y",
  random_effects = "x1",
  max_iter_inn = 1000,
  max_iter_out = 1000,
  tol = 1e-06,
  ntrees = 500,
  mtry = NULL,
  min_node_size = 5,
  max.depth = NULL,
  seed = 1234,
  num.threads = NULL
)
}
\arguments{
\item{df}{A data.frame containing the clustered data.}

\item{id}{Character. Name of the cluster identifier column in \code{df}.}

\item{target}{Character. Name of the binary response column in \code{df}.}

\item{random_effects}{Character. Name of the covariate used for the random slope; the random-effects
design is \code{[1, random_effects]} (random intercept + random slope).}

\item{max_iter_inn}{Integer. Maximum number of inner-loop (EM-like) iterations.}

\item{max_iter_out}{Integer. Maximum number of outer-loop (PQL) iterations.}

\item{tol}{Numeric. Convergence tolerance used for both loops.}

\item{ntrees}{Integer. Number of trees for the random forest.}

\item{mtry}{Integer or NULL. Number of predictors tried at each split in the random forest.
If \code{NULL}, ranger defaults are used.}

\item{min_node_size}{Integer. Minimum terminal node size for the random forest.}

\item{max.depth}{Integer or NULL. Maximum depth of trees in the random forest; \code{NULL} means unlimited.}

\item{seed}{Integer. Random seed passed to the random forest fitting routine.}
}
\value{
A list containing:
\itemize{
\item \code{forest}: fitted ranger forest object (\code{rf$forest})
\item \code{b}: estimated random effects matrix (G x q)
\item \code{D}: estimated random-effects covariance matrix (q x q)
\item \code{sigma2}: estimated residual variance
\item \code{mu}: fitted conditional means (length N)
\item \code{converged_in}: logical vector of inner-loop convergence flags (one per outer iteration)
\item \code{converged_out}: logical flag for outer-loop convergence
\item \code{n_iter}: number of inner-loop iterations performed in the last outer step
\item \code{train_ids}: cluster identifiers used in training (copied from \code{df[[id]]})
\item \code{gll}: trace of generalized log-likelihood values (for diagnostics)
\item \code{tol}: convergence tolerance used
\item \code{num.threads}: number of threads used in ranger
}
}
\description{
Fits a Generalized Mixed-Effects Random Forest (GMERF) model for clustered binary outcomes
using an iterative PQL (outer loop) + EM-like (inner loop) scheme. The fixed-effects component
is estimated via a regression random forest, while the random-effects component is updated
through closed-form updates for \eqn{b}, \eqn{D}, and \eqn{\sigma^2}.
}
\details{
The implementation follows the generalized mixed-effects regression tree / forest framework,
with the fixed-effects learner replaced by a random forest (see References).

This routine relies on helper functions \code{Vi_fun()}, \code{b_fun()}, \code{sigma_fun()},
\code{D_fun()}, and \code{gll_fun()} for mixed-effects updates, and uses \code{ranger::ranger()}
for the fixed-effects regression learner.
}
\examples{
library(ranger)
library(MASS)
# Simulate clustered binary data
df <- sim_data_gmert(G = 20, n_i = 30, seed = 1)

# Fit GMERF
fit <- fit_gmerf(df, ntrees = 200, seed = 1, max_iter_out = 50)

# Inspect convergence
fit$converged_out

}
\references{
Hajjem, Ahlem, François Bellavance, and Denis Larocque. 2011.
“Mixed Effects Regression Trees for Clustered Data.” \emph{Statistics & Probability Letters} 81 (4): 451–59.
\doi{10.1016/j.spl.2010.12.003}.

Hajjem, Ahlem, Denis Larocque, and François Bellavance. 2017.
“Generalized Mixed Effects Regression Trees.” \emph{Statistics & Probability Letters} 126 (July): 114–18.
\doi{10.1016/j.spl.2017.02.033}.

Pellagatti, Massimo, Chiara Masci, Francesca Ieva, and Anna M. Paganoni. 2021.
“Generalized Mixed-Effects Random Forest: A Flexible Approach to Predict University Student Dropout.”
\emph{Statistical Analysis and Data Mining: The ASA Data Science Journal} 14 (3): 241–57.
\doi{10.1002/sam.11505}.
}
\seealso{
\code{\link{predict_gmerf}} for prediction on new data.

\code{\link{fit_gmert}} for the tree-based analogue.

Other gmerf: 
\code{\link{predict_gmerf}()}
}
\concept{gmerf}
