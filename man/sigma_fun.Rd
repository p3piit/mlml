% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sigma_fun.R
\name{sigma_fun}
\alias{sigma_fun}
\title{Update residual variance \eqn{\sigma^2}}
\usage{
sigma_fun(N, G, idx, b, y, Z, D, Vi, s2, fhat, w)
}
\arguments{
\item{N}{Integer. Total number of observations.}

\item{G}{Integer. Number of clusters.}

\item{idx}{List of length \code{G}. Row indices for each cluster.}

\item{b}{Numeric matrix (G x q). Current random-effects estimates.}

\item{y}{Numeric vector length N. Response or pseudo-response.}

\item{Z}{Numeric matrix (N x q). Random-effects design matrix.}

\item{D}{Numeric matrix (q x q). Random-effects covariance matrix.}

\item{Vi}{List of length \code{G}. Cluster-specific covariance matrices \eqn{V_i}.}

\item{s2}{Numeric scalar. Current residual variance.}

\item{fhat}{Numeric vector length N. Fixed-effects predictions.}

\item{w}{Numeric vector length N. Working weights.}
}
\value{
Numeric scalar. Updated estimate of \eqn{\sigma^2}.
}
\description{
Internal helper for GMERT/GMERF. Updates the residual variance parameter
\eqn{\sigma^2} using the closed-form expression derived from the
generalized log-likelihood, aggregating cluster-wise weighted residuals.
}
\keyword{internal}
