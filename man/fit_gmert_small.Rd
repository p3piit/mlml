% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/fit_gmert_small.R
\name{fit_gmert_small}
\alias{fit_gmert_small}
\title{Fit a generalized mixed-effects regression tree (GMERT) using A-inverse updates}
\usage{
fit_gmert_small(
  df,
  id = "id",
  target = "y",
  random_effects = "x1",
  max_iter_inn = 1000,
  max_iter_out = 1000,
  tol = 1e-06,
  cp = 0,
  minsplit = 50,
  minbucket = 20,
  maxdepth = 5,
  xval = 10
)
}
\arguments{
\item{df}{A data.frame containing the response, cluster identifier, random-effect
covariate(s), and fixed-effect predictors.}

\item{id}{Character scalar. Name of the clustering/grouping variable in \code{df}.}

\item{target}{Character scalar. Name of the binary response variable in \code{df}.}

\item{random_effects}{Character scalar. Name(s) of the variable(s) used for the
random-effects design (intercept is added internally).}

\item{max_iter_inn}{Integer. Maximum number of EM-like iterations (inner loop).}

\item{max_iter_out}{Integer. Maximum number of PQL iterations (outer loop).}

\item{tol}{Numeric. Convergence tolerance used for both inner and outer loops.}

\item{cp}{Numeric. Complexity parameter passed to \code{rpart.control()}.}

\item{minsplit}{Integer. Minimum number of observations required to attempt a split.}

\item{minbucket}{Integer. Minimum number of observations in any terminal node.}

\item{maxdepth}{Integer. Maximum depth of the fitted tree.}

\item{xval}{Integer. Number of cross-validation folds in \code{rpart}.}
}
\value{
A list with components:
\describe{
\item{tree}{Fitted \code{rpart} regression tree for the fixed-effects component.}
\item{b}{Matrix of estimated random effects (clusters x q).}
\item{D}{Estimated random-effects covariance matrix.}
\item{sigma2}{Estimated residual variance.}
\item{mu}{Fitted conditional means.}
\item{converged_in}{Logical vector of inner-loop convergence flags (per outer iteration).}
\item{converged_out}{Logical flag for outer-loop convergence.}
\item{n_iter}{Number of inner-loop iterations performed in the last outer iteration.}
\item{train_ids}{Cluster identifiers used for training.}
\item{gll}{Generalized log-likelihood trace used for diagnostics.}
\item{tol}{Tolerance used for convergence checks.}
\item{time}{Elapsed runtime in seconds.}
}
}
\description{
Fits a generalized mixed-effects regression tree model for clustered binary data,
using an optimized set of updates based on precomputing \eqn{A_i^{-1}} to speed up
estimation of the random effects covariance and variance components.
}
\details{
This routine follows the penalized quasi-likelihood (PQL) outer loop and an EM-like
inner loop described for GMERT, while replacing direct \eqn{V_i^{-1}} computations
with cluster-wise precomputed \eqn{A_i^{-1}} matrices.
}
\examples{
# Simulate clustered binary data
df <- sim_data_gmert(G = 10, n_i = 30, seed = 1)

# Fit the optimized GMERT (A^{-1}-based updates)
fit <- fit_gmert_small(df, id = "id", target = "y", random_effects = "x1",
                       max_iter_inn = 50, max_iter_out = 50, tol = 1e-4)

# Predicted classes on training data
pred <- predict_gmert(fit, new_df = df, random_effect = "x1", id = "id")
}
\references{
Hajjem, Ahlem, François Bellavance, and Denis Larocque. 2011. “Mixed Effects Regression Trees for Clustered Data.”
\emph{Statistics & Probability Letters} 81 (4): 451–59. \doi{10.1016/j.spl.2010.12.003}.

Hajjem, Ahlem, Denis Larocque, and François Bellavance. 2017. “Generalized Mixed Effects Regression Trees.”
\emph{Statistics & Probability Letters} 126 (July): 114–18. \doi{10.1016/j.spl.2017.02.033}.
}
\seealso{
\code{\link{fit_gmert}} for the baseline GMERT fitting routine using \eqn{V_i}.

Other gmert: 
\code{\link{fit_gmerf_small}()},
\code{\link{fit_gmert}()},
\code{\link{predict_gmert}()},
\code{\link{sim_data_gmert}()},
\code{\link{split_gmert_data}()}
}
\concept{gmert}
