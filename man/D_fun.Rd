% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/D_fun.R
\name{D_fun}
\alias{D_fun}
\title{Update random-effects covariance matrix D}
\usage{
D_fun(G, idx, b, Z, D, Vi, w)
}
\arguments{
\item{G}{Integer. Number of clusters.}

\item{idx}{List of length \code{G}. Row indices for each cluster.}

\item{b}{Numeric matrix (G x q). Current random-effects estimates.}

\item{Z}{Numeric matrix (N x q). Random-effects design matrix.}

\item{D}{Numeric matrix (q x q). Current random-effects covariance matrix.}

\item{Vi}{List of length \code{G}. Cluster-specific covariance matrices \eqn{V_i}.}

\item{w}{Numeric vector length N. Working weights.}
}
\value{
Numeric matrix (q x q). Updated estimate of the random-effects
covariance matrix \eqn{D}.
}
\description{
Internal helper for GMERT/GMERF. Updates the random-effects covariance
matrix \eqn{D} using the closed-form expression based on the empirical
second moments of the random effects and a shrinkage correction term
derived from the conditional covariance.
}
\keyword{internal}
