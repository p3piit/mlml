% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/fit_gmerf_small.R
\name{fit_gmerf_small}
\alias{fit_gmerf_small}
\title{Fit a generalized mixed-effects random forest (GMERF) using A-inverse updates}
\usage{
fit_gmerf_small(
  df,
  id = "id",
  target = "y",
  random_effects = "x1",
  max_iter_inn = 1000,
  max_iter_out = 1000,
  tol = 1e-06,
  ntrees = 500,
  mtry = NULL,
  min_node_size = 5,
  max.depth = NULL,
  seed = 1234,
  num.threads = NULL
)
}
\arguments{
\item{df}{A data.frame containing the response, cluster identifier, random-effect
covariate(s), and fixed-effect predictors.}

\item{id}{Character scalar. Name of the clustering/grouping variable in \code{df}.}

\item{target}{Character scalar. Name of the binary response variable in \code{df}.}

\item{random_effects}{Character scalar. Name(s) of the variable(s) used for the
random-effects design (intercept is added internally).}

\item{max_iter_inn}{Integer. Maximum number of EM-like iterations (inner loop).}

\item{max_iter_out}{Integer. Maximum number of PQL iterations (outer loop).}

\item{tol}{Numeric. Convergence tolerance used for both inner and outer loops.}

\item{ntrees}{Integer. Number of trees for the random forest.}

\item{mtry}{Integer or \code{NULL}. Number of candidate features tried at each split
(passed to \code{ranger::ranger}; \code{NULL} uses \code{ranger}'s default).}

\item{min_node_size}{Integer. Minimum terminal node size for the forest.}

\item{max.depth}{Integer or \code{NULL}. Maximum tree depth for the forest
(\code{NULL} = unlimited).}

\item{seed}{Integer. Random seed for reproducibility.}

\item{num.threads}{Integer or \code{NULL}. Number of threads used by \code{ranger}
(\code{NULL} uses all available threads).}
}
\value{
A list with components:
\describe{
\item{forest}{Fitted random forest object (stored as \code{rf$forest}).}
\item{b}{Matrix of estimated random effects (clusters x q).}
\item{D}{Estimated random-effects covariance matrix.}
\item{sigma2}{Estimated residual variance.}
\item{mu}{Fitted conditional means.}
\item{converged_in}{Logical vector of inner-loop convergence flags (per outer iteration).}
\item{converged_out}{Logical flag for outer-loop convergence.}
\item{n_iter}{Number of inner-loop iterations performed in the last outer iteration.}
\item{train_ids}{Cluster identifiers used for training.}
\item{gll}{Generalized log-likelihood trace used for diagnostics.}
\item{tol}{Tolerance used for convergence checks.}
}
}
\description{
Fits a generalized mixed-effects model where the fixed-effects component is learned
via a random forest and the random effects account for clustered/longitudinal
dependence. Estimation proceeds via a PQL outer loop and an EM-like inner loop,
using precomputed cluster-specific \eqn{A_i^{-1}} matrices to update random effects
and variance components efficiently.
}
\examples{
# Simulate clustered binary data
df <- sim_data_gmert(G = 10, n_i = 30, seed = 1)

# Fit the optimized GMERF (A^{-1}-based updates)
fit <- fit_gmerf_small(df, id = "id", target = "y", random_effects = "x1",
                       max_iter_inn = 50, max_iter_out = 50, tol = 1e-4,
                       ntrees = 100, seed = 1)

# Predicted classes on training data
pred <- predict_gmerf(fit, new_df = df, random_effects = "x1", id = "id")
}
\references{
Hajjem, Ahlem, François Bellavance, and Denis Larocque. 2011.
“Mixed Effects Regression Trees for Clustered Data.” \emph{Statistics & Probability Letters} 81 (4): 451–59.
\doi{10.1016/j.spl.2010.12.003}.

Hajjem, Ahlem, Denis Larocque, and François Bellavance. 2017.
“Generalized Mixed Effects Regression Trees.” \emph{Statistics & Probability Letters} 126 (July): 114–18.
\doi{10.1016/j.spl.2017.02.033}.

Pellagatti, Massimo, Chiara Masci, Francesca Ieva, and Anna M. Paganoni. 2021.
“Generalized Mixed-Effects Random Forest: A Flexible Approach to Predict University Student Dropout.”
\emph{Statistical Analysis and Data Mining: The ASA Data Science Journal} 14 (3): 241–57.
\doi{10.1002/sam.11505}.
}
\seealso{
\code{\link{fit_gmerf}} for the baseline GMERF fitting routine;
\code{\link{fit_gmert_small}} for the tree-based \eqn{A^{-1}} optimized variant.

Other gmert: 
\code{\link{fit_gmert}()},
\code{\link{fit_gmert_small}()},
\code{\link{predict_gmert}()},
\code{\link{sim_data_gmert}()},
\code{\link{split_gmert_data}()}
}
\concept{gmert}
