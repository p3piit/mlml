% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sigma_fun_small.R
\name{sigma_fun_small}
\alias{sigma_fun_small}
\title{Update residual variance using precomputed \eqn{A_i^{-1}}}
\usage{
sigma_fun_small(N, G, idx, Z, w, y_t, fhat, b, Ainv, sigma2)
}
\arguments{
\item{N}{Integer. Total number of observations.}

\item{G}{Integer. Number of clusters.}

\item{idx}{List of length G. Each element contains the row indices for a given
cluster.}

\item{Z}{Numeric matrix (N x q). Random-effects design matrix.}

\item{w}{Numeric vector of length N. Observation-level weights.}

\item{y_t}{Numeric vector of length N. Pseudo-response (working response).}

\item{fhat}{Numeric vector of length N. Current fitted fixed-part predictions.}

\item{b}{Numeric matrix (G x q). Current random effects (one row per cluster).}

\item{Ainv}{List of length G. Each element is a (q x q) matrix representing
\eqn{A_i^{-1}} for the corresponding cluster.}

\item{sigma2}{Numeric scalar. Current residual variance value used in the update.}
}
\value{
A numeric scalar giving the updated residual variance estimate.
}
\description{
Updates the residual variance parameter \eqn{\sigma^2} using cluster-wise
quantities and the precomputed matrices \eqn{A_i^{-1}} (typically obtained
from \code{\link{Ajnv_fun}}). This is the “small” (optimized) counterpart of
\code{\link{sigma_fun}}, avoiding direct formation/inversion of \eqn{V_i}.
}
\details{
The update aggregates a weighted residual sum of squares across clusters and
includes a trace adjustment term involving \eqn{\mathrm{tr}(V_i^{-1})},
computed efficiently via \eqn{A_i^{-1}}.
}
\keyword{internal}
