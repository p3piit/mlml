% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/b_fun_small.R
\name{b_fun_small}
\alias{b_fun_small}
\title{Update cluster-specific random effects using precomputed \eqn{A_i^{-1}}}
\usage{
b_fun_small(G, Z, w, idx, y_t, fhat, Ainv, sigma2)
}
\arguments{
\item{G}{Integer. Number of clusters.}

\item{Z}{Numeric matrix (N x q). Random-effects design matrix.}

\item{w}{Numeric vector of length N. Observation-level weights.}

\item{idx}{List of length G. Each element contains the row indices of \code{Z}
(and associated vectors) corresponding to a given cluster.}

\item{y_t}{Numeric vector of length N. Pseudo-response (working response).}

\item{fhat}{Numeric vector of length N. Current fitted fixed-part predictions.}

\item{Ainv}{List of length G. Each element is a (q x q) matrix representing
\eqn{A_i^{-1}} for the corresponding cluster.}

\item{sigma2}{Numeric scalar. Current residual variance.}
}
\value{
A numeric matrix of dimension (G x q) containing the updated random
effects for each cluster.
}
\description{
Computes the updated random effects \eqn{b_i} for each cluster \eqn{i} using
the precomputed inverse matrices \eqn{A_i^{-1}} (typically returned by
\code{\link{Ajnv_fun}}). This version avoids forming and inverting \eqn{V_i}
directly, and is used in the “small” GMERT / GMERF optimization routines.
}
\details{
For each cluster \eqn{i}, this function computes
\deqn{b_i = A_i^{-1} \cdot (1/\sigma^2) Z_i^T W_i (y^*_i - f_i)}
where \eqn{y^*_i} is the pseudo-response restricted to cluster \eqn{i},
\eqn{f_i} is the fixed-part prediction, and \eqn{W_i} is a diagonal matrix of
working weights.
}
\keyword{internal}
